#include "Speaker.h"


void Speaker::jouerMelodie() {
    jouerSon(RE);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(FA4);

    _delay_ms(NOIRE / 2);

    jouerSon(FA4);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 8);

    jouerSon(SOL4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(FA4);

    _delay_ms(NOIRE / 2);

    jouerSon(FA4);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 4);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 8);

    jouerSon(SOL4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(LA);

    _delay_ms(NOIRE / 2);

    jouerSon(LA);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 8);

    jouerSon(SOL4);

    _delay_ms(NOIRE / 8);

    jouerSon(SI);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 8);

    jouerSon(DO);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(LA);

    _delay_ms(NOIRE / 2);

    jouerSon(LA);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 8);

    jouerSon(SOL4);

    _delay_ms(NOIRE / 8);

    jouerSon(SI);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 8);

    jouerSon(DO);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(FA4);

    _delay_ms(NOIRE / 2);

    jouerSon(FA4);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 8);

    jouerSon(SOL4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(FA4);

    _delay_ms(NOIRE / 2);

    jouerSon(FA4);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 8);

    jouerSon(SOL4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(LA);

    _delay_ms(NOIRE / 2);

    jouerSon(LA);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 8);

    jouerSon(SOL4);

    _delay_ms(NOIRE / 8);

    jouerSon(SI);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 8);

    jouerSon(DO);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(LA);

    _delay_ms(NOIRE / 2);

    jouerSon(LA);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    jouerSon(MI4);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 8);

    jouerSon(SOL4);

    _delay_ms(NOIRE / 8);

    jouerSon(SI);

    _delay_ms(NOIRE / 8);

    jouerSon(RE);

    _delay_ms(NOIRE / 8);

    jouerSon(SOL4);

    _delay_ms(NOIRE / 8);

    jouerSon(FA4);

    _delay_ms(NOIRE / 8);

    arreterSon();

}

void Speaker::jouerMelodie2() {
    jouerSon(LA);

    _delay_ms(NOIRE / 4);

    jouerSon(MI3);

    _delay_ms(NOIRE / 4);

    jouerSon(LA);

    _delay_ms(NOIRE / 4);

    jouerSon(MI4);

    _delay_ms(NOIRE / 4);

    jouerSon(RE);

    _delay_ms(NOIRE / 4);

    jouerSon(DO);

    _delay_ms(NOIRE / 4);

    jouerSon(SOL3);

    _delay_ms(NOIRE / 2);

    jouerSon(LA);

    _delay_ms(NOIRE / 4);

    jouerSon(MI3);

    _delay_ms(NOIRE / 4);

    jouerSon(LA);

    _delay_ms(NOIRE / 4);

    jouerSon(MI4);

    _delay_ms(NOIRE / 4);

    jouerSon(RE);

    _delay_ms(NOIRE / 4);

    jouerSon(DO);

    _delay_ms(NOIRE / 4);

    jouerSon(SOL3);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 4);

    jouerSon(SI);

    _delay_ms(NOIRE / 4);

    jouerSon(SOL3);

    _delay_ms(NOIRE / 4);

    jouerSon(DO);

    _delay_ms(NOIRE / 2);

    jouerSon(SI);

    _delay_ms(NOIRE / 4);

    jouerSon(SOL3);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 4);

    jouerSon(SI);

    _delay_ms(NOIRE / 4);

    jouerSon(SOL3);

    _delay_ms(NOIRE / 4);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(SI);

    _delay_ms(NOIRE / 4);

    jouerSon(SOL3);

    _delay_ms(NOIRE / 2);

    jouerSon(LA);

    _delay_ms(NOIRE / 4);

    jouerSon(MI3);

    _delay_ms(NOIRE / 4);

    jouerSon(LA);

    _delay_ms(NOIRE / 4);

    jouerSon(MI4);

    _delay_ms(NOIRE / 4);

    jouerSon(RE);

    _delay_ms(NOIRE / 4);

    jouerSon(DO);

    _delay_ms(NOIRE / 4);

    jouerSon(SOL3);

    _delay_ms(NOIRE / 2);

    jouerSon(LA);

    _delay_ms(NOIRE / 4);

    jouerSon(MI3);

    _delay_ms(NOIRE / 4);

    jouerSon(LA);

    _delay_ms(NOIRE / 4);

    jouerSon(MI4);

    _delay_ms(NOIRE / 4);

    jouerSon(RE);

    _delay_ms(NOIRE / 4);

    jouerSon(DO);

    _delay_ms(NOIRE / 4);

    jouerSon(SOL3);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 4);

    jouerSon(DO);

    _delay_ms(NOIRE / 2);

    jouerSon(DO);

    _delay_ms(NOIRE / 4);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 4);

    jouerSon(MI4);

    _delay_ms(NOIRE / 2);

    jouerSon(MI4);

    _delay_ms(NOIRE / 4);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    jouerSon(RE);

    _delay_ms(NOIRE / 2);

    arreterSon();

}

void Speaker::arreterSon() {
    TCCR0A = 0;
}

void Speaker::initialisationSpeaker(void) {
    cli();

    DDRB = 0xff;

    sei();

}

void Speaker::jouerSon(int note) {
    arreterSon();

    _delay_ms(10);

    double freq = Notes[note - 45];

    double tempsCalcule = F_CPU * (1 / freq) / 2 / 256;

    OCR0A = tempsCalcule;

    // Mode 1 de Waveform Generation Mode, clear on compare match

    TCCR0A = (1 << WGM01) | (1 << COM0A0);

    // Prescaler 8

    TCCR0B = (1 << CS02);

    TCCR1C = 0;

}

double Speaker::trouverFrequence(int note) {
    return 0;
}


Speaker::Speaker() {

    initialisationSpeaker();
}
